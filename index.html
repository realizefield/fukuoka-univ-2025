<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¦å²¡å¤§å­¦ è‹±èª å®Œå…¨å­¦ç¿’æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ ã€å®Œå…¨ç¶²ç¾…ç‰ˆã€‘</title>
  <style>
    :root { --fu-red: #a00000; --highlight-yellow: rgba(255, 255, 0, 0.3); }
    body { font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif; max-width: 1100px; margin: 0 auto; padding: 20px; background: #fdfdfd; color: #333; line-height: 1.8; }
    .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid var(--fu-red); padding-bottom: 10px; margin-bottom: 20px; }
    h1 { color: var(--fu-red); margin: 0; font-size: 1.4em; }
    .card { background: white; border: 1px solid #ddd; padding: 25px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .btn { background: var(--fu-red); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; display: inline-flex; align-items: center; gap: 5px; }
    .btn:hover { background: #d00000; transform: translateY(-2px); }
    .btn-sub { background: #666; margin-right: 5px; }
    .sentence-block { border-left: 5px solid var(--fu-red); padding: 15px 20px; margin-bottom: 10px; background: #fff; cursor: pointer; }
    .highlight { background-color: var(--highlight-yellow) !important; }
    .eng-text { font-size: 1.25em; font-weight: 500; color: #111; display: block; margin-bottom: 8px; }
    .dict-word { color: #d63031; font-weight: bold; border-bottom: 2px solid #ffadad; cursor: pointer; }
    #word-popup { position: absolute; background: white; border: 2px solid var(--fu-red); padding: 15px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: none; z-index: 5000; min-width: 240px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center; }
    .modal-content { background: white; width: 90%; max-width: 850px; padding: 30px; border-radius: 15px; max-height: 85vh; overflow-y: auto; }
    .info-box { background: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid var(--fu-red); }
    .test-section { display: none; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .v-choice-btn { display: block; width: 100%; max-width: 400px; margin: 10px auto; padding: 12px; border: 1px solid #ddd; border-radius: 8px; background: #fff; cursor: pointer; font-size: 1.1em; }
  </style>
</head>
<body onclick="initAudioOnce()">

<div id="learning-ui">
  <div class="header">
    <h1>ğŸ« ç¦å²¡å¤§å­¦ è‹±èª å®Œå…¨å­¦ç¿’æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ </h1>
    <button class="btn" onclick="showTest()">ğŸ¯ åˆæ ¼åˆ¤å®šãƒ†ã‚¹ãƒˆã«é€²ã‚€</button>
  </div>

  <div class="card">
    <strong>ğŸ”Š èª­ä¸Šã’é€Ÿåº¦</strong>: <input type="range" id="v-speed" min="0.5" max="1.5" step="0.1" value="1.0">
    <p><small>â€»ã€ŒğŸ”Š å†ç”Ÿã€ãƒœã‚¿ãƒ³ã§éŸ³å£°ãŒå‡ºã¾ã™ã€‚å˜èªã‚¯ãƒªãƒƒã‚¯ã§æ„å‘³ãƒ»ç™ºéŸ³ã€‚æ–‡ã‚¯ãƒªãƒƒã‚¯ã§é»„è‰²ãƒãƒ¼ã‚«ãƒ¼ã€‚</small></p>
  </div>

  <div class="card">
    <h2>ğŸ“– é•·æ–‡ç²¾èª­ãƒ»å®Œå…¨è§£èª¬</h2>
    <div id="main-content"></div>
    <div style="background: #eee; padding: 15px; border-radius: 8px; font-size: 0.9em; margin-top: 20px;">
      <strong>ã€æ³¨ã€‘</strong> visa(s)ï¼šãƒ“ã‚¶ï¼ŒæŸ»è¨¼ / expireï¼šæœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã‚‹
    </div>
  </div>

  <div class="card">
    <h2>ğŸŒŸ ä¿å­˜ã—ãŸå˜èªå¸³</h2>
    <div id="my-vocab-list"></div>
    <div id="vocab-test-entry" style="display:none; text-align: center; margin-top:20px;">
      <button class="btn" style="background:#e67e22" onclick="startVocabTest()">ğŸ“™ ä¿å­˜ã—ãŸå˜èªã®ãƒ†ã‚¹ãƒˆã‚’å§‹ã‚ã‚‹</button>
      <button class="btn btn-sub" style="background:#e74c3c" onclick="clearVocab()">å˜èªå¸³ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </div>
</div>

<div id="test-section" class="test-section">
  <div class="header"><h1>ğŸ¯ åˆæ ¼åˆ¤å®šãƒ†ã‚¹ãƒˆ</h1><button class="btn btn-sub" onclick="showLearning()">â¬… è§£èª¬ã«æˆ»ã‚‹</button></div>
  <div class="card"><div id="test-content"></div><div style="text-align:center;"><button class="btn" onclick="judge()">åˆ¤å®šã™ã‚‹</button></div><div id="result-area" style="margin-top:20px;"></div></div>
</div>

<div id="vocab-test-section" class="test-section">
  <div class="header"><h1>ğŸ“™ å˜èªå¸³ãƒ†ã‚¹ãƒˆ</h1><button class="btn btn-sub" onclick="showLearning()">â¬… è§£èª¬ã«æˆ»ã‚‹</button></div>
  <div class="card" style="text-align:center;">
    <div id="v-test-q-num" style="color:#888;"></div>
    <h2 id="v-test-word" style="font-size:3em; color:var(--fu-red); margin:20px 0;"></h2>
    <div id="v-test-choices"></div>
    <div id="v-test-feedback" style="margin-top:20px; font-weight:bold; height:30px;"></div>
  </div>
</div>

<div id="word-popup"></div>
<div id="modal" class="modal" onclick="closeM()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <h3 id="m-title" style="color:var(--fu-red); border-bottom:2px solid var(--fu-red); padding-bottom:5px;"></h3>
    <div id="m-body"></div>
    <button class="btn" onclick="closeM()" style="width:100%; margin-top:20px;">é–‰ã˜ã‚‹</button>
  </div>
</div>

<script>
let audioUnlocked = false;
function initAudioOnce() { if (!audioUnlocked) { window.speechSynthesis.getVoices(); audioUnlocked = true; } }
function speak(text) {
  window.speechSynthesis.cancel();
  const uttr = new SpeechSynthesisUtterance(text);
  uttr.lang = 'en-US';
  uttr.rate = parseFloat(document.getElementById('v-speed').value);
  window.speechSynthesis.speak(uttr);
}

// æä¾›ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€å­—ä¸€å¥é•ã‚ãšå®Œå…¨ã«æ ¼ç´ï¼ˆæ–‡29ã€å’Œè¨³ã€æ§‹æ–‡ãƒ»èªæ³•ã€é‡è¦èªå¥ï¼‰
const syntaxData = [
  {
    e: "In Japan, â€œidentityâ€ and â€œopportunityâ€ are two factors that affect the choices of parents who wish to raise their children as bilinguals â€” people able to speak two languages.",
    t: "æ—¥æœ¬ã«ãŠã„ã¦ã€ã€Œã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€ã¨ã€Œæ©Ÿä¼šã€ã¯ã€å­ä¾›ã‚’ãƒã‚¤ãƒªãƒ³ã‚¬ãƒ«ï¼ˆ2ã¤ã®è¨€èªã‚’è©±ã™ã“ã¨ãŒã§ãã‚‹äººã€…ï¼‰ã¨ã—ã¦è‚²ã¦ãŸã„ã¨é¡˜ã†è¦ªã®é¸æŠã«å½±éŸ¿ã‚’ä¸ãˆã‚‹2ã¤ã®è¦å› ã§ã™ã€‚",
    g: "that affect...ï¼ˆé–¢ä¿‚ä»£åè©ãƒ»ä¸»æ ¼ï¼‰ãŒfactorsã‚’ä¿®é£¾ã—ã¦ã„ã¾ã™ã€‚who wish to...ï¼ˆé–¢ä¿‚ä»£åè©ï¼‰ã¯parentsã‚’ä¿®é£¾ã—ã¦ã„ã¾ã™ã€‚",
    p: "factorï¼šè¦å› \naffectï¼šå½±éŸ¿ã‚’ä¸ãˆã‚‹\nraiseï¼šè‚²ã¦ã‚‹",
    ans: ""
  },
  {
    e: "Below are three ( A ) this may be said to be true.",
    t: "ä»¥ä¸‹ã«ã€ã“ã®ã“ã¨ãŒã„ã‹ã«çœŸå®Ÿã§ã‚ã‚‹ã¨è¨€ãˆã‚‹ã‹ã‚’èª¬æ˜ã™ã‚‹3ã¤ã®çŸ­ã„ç‰©èªãŒã‚ã‚Šã¾ã™ã€‚",
    g: "æ–‡é ­ã«å‰¯è© Below ãŒå‡ºãŸãŸã‚ã®å€’ç½®å½¢ã§ã™ï¼ˆæœ¬æ¥ã¯ Three stories are belowï¼‰ã€‚how... ã¯explainã®ç›®çš„èªã¨ãªã‚‹é–“æ¥ç–‘å•æ–‡ã§ã™ã€‚",
    p: "be said to be...ï¼šã€œã§ã‚ã‚‹ã¨è¨€ã‚ã‚Œã‚‹",
    ans: "7",
    hint: "ã“ã‚Œã‹ã‚‰3ã¤ã®ç‰©èªã‚’ç´¹ä»‹ã™ã‚‹å°å…¥æ–‡ã§ã™ã€‚å¾Œã«ç¶šãå†…å®¹ã‚’èª¬æ˜ã™ã‚‹ã€Œç‰©èªã€ã‚’è¡¨ã™è¨€è‘‰ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚"
  },
  {
    e: "Joshua graduated from an international university in Japan many years ago.",
    t: "ã‚¸ãƒ§ã‚·ãƒ¥ã‚¢ã¯ä½•å¹´ã‚‚å‰ã«æ—¥æœ¬ã®å›½éš›å¤§å­¦ã‚’å’æ¥­ã—ã¾ã—ãŸã€‚",
    g: "graduate from... ã§ã€Œã€œã‚’å’æ¥­ã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚",
    p: "graduateï¼šå’æ¥­ã™ã‚‹",
    ans: ""
  },
  {
    e: "Instead of returning to the Philippines, he found employment at a company and eventually gained permanent resident status.",
    t: "ãƒ•ã‚£ãƒªãƒ”ãƒ³ã«å¸°ã‚‹ä»£ã‚ã‚Šã«ã€å½¼ã¯ã‚ã‚‹ä¼šç¤¾ã«å°±è·ã—ã€æœ€çµ‚çš„ã«æ°¸ä½æ¨©ã‚’å¾—ã¾ã—ãŸã€‚",
    g: "Instead of -ing ã§ã€Œã€œã™ã‚‹ä»£ã‚ã‚Šã«ã€ã¨ã„ã†è¡¨ç¾ã§ã™ã€‚",
    p: "employmentï¼šé›‡ç”¨ãƒ»è·\npermanent resident statusï¼šæ°¸ä½æ¨©",
    ans: ""
  },
  {
    e: "Some time later, he married a Japanese woman, Mimi, and they started a family.",
    t: "ã—ã°ã‚‰ãã—ã¦ã€å½¼ã¯æ—¥æœ¬äººã®å¥³æ€§ã€ãƒŸãƒŸã¨çµå©šã—ã€å®¶åº­ã‚’ç¯‰ãã¾ã—ãŸã€‚",
    g: "married ã¯ä»–å‹•è©ã§ã™ã®ã§ã€married with ã¨ã—ãªã„ã‚ˆã†ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚start a family ã¯ã€Œå®¶åº­ã‚’ç¯‰ãã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚",
    p: "marriedï¼šã€œã¨çµå©šã—ãŸ\nstart a familyï¼šå®¶åº­ã‚’ç¯‰ã",
    ans: ""
  },
  {
    e: "At home, Joshua and Mimi ( B ) in English and Japanese.",
    t: "å®¶åº­ã§ã¯ã€ã‚¸ãƒ§ã‚·ãƒ¥ã‚¢ã¨ãƒŸãƒŸã¯è‹±èªã¨æ—¥æœ¬èªã§å­ä¾›ãŸã¡ã¨è©±ã™ã‚ˆã†æ„è­˜çš„ãªåŠªåŠ›ã‚’ã—ã¾ã—ãŸã€‚",
    g: "make a conscious effort to do ã§ã€Œæ„è­˜çš„ã«ã€œã—ã‚ˆã†ã¨åŠªåŠ›ã™ã‚‹ã€ã¨ã„ã†è¡¨ç¾ã§ã™ã€‚",
    p: "consciousï¼šæ„è­˜çš„ãª\neffortï¼šåŠªåŠ›",
    ans: "9",
    hint: "å®¶åº­å†…ã§ã‚¸ãƒ§ã‚·ãƒ¥ã‚¢ãŸã¡ãŒå­ä¾›ã«å¯¾ã—ã¦è¡Œã£ãŸè¨€èªçš„åŠªåŠ›ã‚’æŒ‡ã™è¨€è‘‰ã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚"
  },
  {
    e: "However, Joshua still strongly identified as a native speaker of Tagalog, one of the official languages of the Philippines.",
    t: "ã—ã‹ã—ã€ã‚¸ãƒ§ã‚·ãƒ¥ã‚¢ã¯ä¾ç„¶ã¨ã—ã¦ã€ãƒ•ã‚£ãƒªãƒ”ãƒ³ã®å…¬ç”¨èªã®ä¸€ã¤ã§ã‚ã‚‹ã‚¿ã‚¬ãƒ­ã‚°èªã®ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã§ã‚ã‚‹ã¨ã„ã†å¼·ã„è‡ªèªã‚’æŒã£ã¦ã„ã¾ã—ãŸã€‚",
    g: "identify as... ã§ã€Œã€œã¨ã—ã¦ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æŒã¤ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚",
    p: "identify as...ï¼šã€œã¨ã—ã¦ã®è‡ªèªã‚’æŒã¤\nofficial languageï¼šå…¬ç”¨èª",
    ans: ""
  },
  {
    e: "One summer, his family took a trip there so that his two pre-school children could meet their cousins of roughly the same age.",
    t: "ã‚ã‚‹å¤ã€å½¼ã®å®¶æ—ã¯ã€2äººã®æœªå°±å­¦å…ãŒã»ã¼åŒå¹´é½¢ã®ã„ã¨ã“ãŸã¡ã«ä¼šãˆã‚‹ã‚ˆã†ã«ã¨ã€ãƒ•ã‚£ãƒªãƒ”ãƒ³ã¸æ—…è¡Œã—ã¾ã—ãŸã€‚",
    g: "so that S can [could] ... ã§ã€ŒSãŒã€œã§ãã‚‹ã‚ˆã†ã«ã€ã¨ã„ã†ç›®çš„ã‚’è¡¨ã—ã¾ã™ã€‚roughly ã¯ã€ŒãŠã‚ˆãã€ã§ã™ã€‚",
    p: "roughlyï¼šãŠã‚ˆã\npre-schoolï¼šå°±å­¦å‰ã®",
    ans: ""
  },
  {
    e: "They had a fun time, but unfortunately, the kids ( C ) Joshua decided he would begin teaching them Tagalog to prepare them for their next visit to the Philippines.",
    t: "å½¼ã‚‰ã¯æ¥½ã—ã„æ™‚é–“ã‚’éã”ã—ã¾ã—ãŸãŒã€ã‚ã„ã«ãã€å­ä¾›ãŸã¡ã¯ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã¨ã‚‹ã®ã«éå¸¸ã«è‹¦åŠ´ã—ãŸãŸã‚ã€ã‚¸ãƒ§ã‚·ãƒ¥ã‚¢ã¯æ¬¡å›ã®ãƒ•ã‚£ãƒªãƒ”ãƒ³è¨ªå•ã«å‚™ãˆã¦å½¼ã‚‰ã«ã‚¿ã‚¬ãƒ­ã‚°èªã‚’æ•™ãˆå§‹ã‚ã‚ˆã†ã¨æ±ºå¿ƒã—ã¾ã—ãŸã€‚",
    g: "so ... that ã€œï¼ˆéå¸¸ã«â€¦ãªã®ã§ã€œã ï¼‰ã®æ§‹æ–‡ãŒéš ã‚Œã¦ã„ã¾ã™ã€‚struggled to communicate ã§ã€Œæ„æ€ç–é€šã«è‹¦åŠ´ã—ãŸã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚",
    p: "unfortunatelyï¼šã‚ã„ã«ã\nstruggle toï¼šã€œã™ã‚‹ã®ã«è‹¦åŠ´ã™ã‚‹\nprepare forï¼šã€œã«å‚™ãˆã‚‹",
    ans: "1",
    hint: "æ—…è¡Œå…ˆã§å­ä¾›ãŸã¡ãŒã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è‹¦åŠ´ã—ãŸçµæœã€çˆ¶è¦ªãŒæ±ºå¿ƒã—ãŸå†…å®¹ã«ç¹‹ãŒã‚Šã¾ã™ã€‚"
  },
  {
    e: "The case of Joshua and Mimi shows how parents make language choices to ensure that children develop a healthy sense of identity â€” to know who they are.",
    t: "ã‚¸ãƒ§ã‚·ãƒ¥ã‚¢ã¨ãƒŸãƒŸã®äº‹ä¾‹ã¯ã€å­ä¾›ãŸã¡ãŒå¥å…¨ãªã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æ„Ÿè¦šã‚’é¤Šã†ï¼ˆè‡ªåˆ†ãŒä½•è€…ã‹ã‚’çŸ¥ã‚‹ï¼‰ã“ã¨ã‚’ç¢ºå®Ÿã«ã™ã‚‹ãŸã‚ã«ã€è¦ªãŒã„ã‹ã«è¨€èªã®é¸æŠã‚’è¡Œã†ã‹ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚",
    g: "ensure that... ã¯ã€Œã€œã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºå®Ÿã«ã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚",
    p: "ensureï¼šç¢ºå®Ÿã«ã™ã‚‹\nhealthyï¼šå¥å…¨ãª",
    ans: ""
  },
  {
    e: "Emi grew up in a Japanese home a few hours from Tokyo.",
    t: "ã‚¨ãƒŸã¯æ±äº¬ã‹ã‚‰æ•°æ™‚é–“ã®ã¨ã“ã‚ã«ã‚ã‚‹æ—¥æœ¬ã®å®¶åº­ã§è‚²ã¡ã¾ã—ãŸã€‚",
    g: "grow upï¼ˆè‚²ã¤ï¼‰ã®éå»å½¢ grew up ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚",
    p: "grow upï¼šè‚²ã¤",
    ans: ""
  },
  {
    e: "Her parents hardly spoke English at all.",
    t: "å½¼å¥³ã®ä¸¡è¦ªã¯è‹±èªã‚’å…¨ãã¨è¨€ã£ã¦ã„ã„ã»ã©è©±ã—ã¾ã›ã‚“ã§ã—ãŸã€‚",
    g: "hardly ã¯æº–å¦å®šèªã§ã€Œã»ã¨ã‚“ã©ã€œãªã„ã€ã‚’æ„å‘³ã—ã€at all ã¨çµ„ã¿åˆã‚ã•ã£ã¦ã„ã¾ã™ã€‚",
    p: "hardly... at allï¼šå…¨ãã€œãªã„",
    ans: ""
  },
  {
    e: "Although they were employed at different companies, they both noticed that co-workers who were highly skilled in English seemed to regularly get promotions ahead of them.",
    t: "åˆ¥ã€…ã®ä¼šç¤¾ã«å‹¤ã‚ã¦ã„ã¾ã—ãŸãŒã€è‹±èªãŒéå¸¸ã«å ªèƒ½ãªåŒåƒšãŒè‡ªåˆ†ãŸã¡ã‚ˆã‚Šã‚‚å…ˆã«å®šæœŸçš„ã«æ˜‡é€²ã—ã¦ã„ã‚‹ã‚ˆã†ã ã¨äºŒäººã¨ã‚‚æ°—ã¥ãã¾ã—ãŸã€‚",
    g: "Although ã¯ã€Œã€œã ã‘ã‚Œã©ã‚‚ã€ã¨ã„ã†æ¥ç¶šè©ã§ã™ã€‚ahead of them ã¯ã€Œå½¼ã‚‰ã‚ˆã‚Šå…ˆã«ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚",
    p: "promotionï¼šæ˜‡é€²\nskilledï¼šç†Ÿç·´ã—ãŸ",
    ans: ""
  },
  {
    e: "They recognized that this is just the way global businesses operate, so they ( D ).",
    t: "å½¼ã‚‰ã¯ã€ã“ã‚ŒãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ä¼æ¥­ã®ã‚ã‚Šæ–¹ãªã®ã ã¨èªè­˜ã—ã¦ã„ãŸã®ã§ã€ãã‚Œã»ã©è½èƒ†ã¯ã—ã¾ã›ã‚“ã§ã—ãŸã€‚",
    g: "the way S V ã¯ã€ŒSãŒVã™ã‚‹ã‚„ã‚Šæ–¹ã€ã§ã™ã€‚operate ã¯ã€Œé‹å–¶ã•ã‚Œã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚",
    p: "recognizeï¼šèªè­˜ã™ã‚‹\noperateï¼šé‹å–¶ã•ã‚Œã‚‹",
    ans: "4",
    hint: "å®ŸåŠ›ã®å·®ã‚’èªè­˜ã—ã¦ã„ãŸãŸã‚ã€è‡ªåˆ†ãŸã¡ã®ç¾çŠ¶ã‚’ã©ã†å—ã‘æ­¢ã‚ãŸã‹ã‚’è€ƒãˆã¾ã™ã€‚"
  },
  {
    e: "The future would be brighter for their only daughter, though.",
    t: "ã—ã‹ã—ã€ä¸€äººå¨˜ã®æœªæ¥ã¯ã‚ˆã‚Šæ˜ã‚‹ã„ã‚‚ã®ã«ãªã‚‹ã ã‚ã†ã€‚",
    g: "æ–‡æœ«ã® though ã¯ã€Œã—ã‹ã—ãªãŒã‚‰ã€ã¨ã„ã†å‰¯è©çš„ç”¨æ³•ã§ã™ã€‚",
    p: "brightï¼šæ˜ã‚‹ã„\nthoughï¼šã—ã‹ã—ãªãŒã‚‰",
    ans: ""
  },
  {
    e: "Firmly resolved, they carried out a lengthy search, then found a unique private school for her where courses would be taught in both Japanese and English.",
    t: "å¼·ãæ±ºå¿ƒã—ãŸå½¼ã‚‰ã¯ã€é•·æœŸã«ã‚ãŸã‚‹æ¢ç´¢ã‚’è¡Œã„ã€æ—¥æœ¬èªã¨è‹±èªã®ä¸¡æ–¹ã§æˆæ¥­ãŒè¡Œã‚ã‚Œã‚‹ç§ç«‹å­¦æ ¡ã‚’è¦‹ã¤ã‘ã¾ã—ãŸã€‚",
    g: "Firmly resolved ã¯åˆ†è©æ§‹æ–‡ã§ã€Œå¼·ãæ±ºæ„ã—ã¦ã€ã¨ãªã‚Šã¾ã™ã€‚where ã¯é–¢ä¿‚å‰¯è©ã§ã™ã€‚",
    p: "firmlyï¼šå …ã\nlengthyï¼šé•·ã„",
    ans: ""
  },
  {
    e: "In Emiâ€™s case, becoming bilingual had far less to do with identity; her Japanese parents were acting on a perceived need to give their child what they believed to be the best chance possible to succeed in a changing world.",
    t: "ã‚¨ãƒŸã®äº‹ä¾‹ã§ã¯ã€ãƒã‚¤ãƒªãƒ³ã‚¬ãƒ«ã«ãªã‚‹ã“ã¨ã¯ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨ã¯ã»ã¨ã‚“ã©é–¢ä¿‚ãŒãªãã€æˆåŠŸã®ãƒãƒ£ãƒ³ã‚¹ã‚’ä¸ãˆã‚‹ãŸã‚ã®è¦ªã®è¡Œå‹•ã§ã—ãŸã€‚",
    g: "have less to do with... ã§ã€Œã€œã¨ã‚ã¾ã‚Šé–¢ä¿‚ãŒãªã„ã€ã®æ¯”è¼ƒç´šã§ã™ã€‚perceived ã¯ã€Œèªè­˜ã•ã‚ŒãŸã€ã§ã™ã€‚",
    p: "have less to do withï¼šã€œã¨ã‚ã¾ã‚Šé–¢ä¿‚ãŒãªã„\nsucceedï¼šæˆåŠŸã™ã‚‹",
    ans: ""
  },
  {
    e: "Kanako and Masa met in the US while attending college as exchange students.",
    t: "ã‚«ãƒŠã‚³ã¨ãƒã‚µã¯ã€äº¤æ›ç•™å­¦ç”Ÿã¨ã—ã¦å¤§å­¦ã«é€šã£ã¦ã„ã‚‹é–“ã«ã‚¢ãƒ¡ãƒªã‚«ã§å‡ºä¼šã„ã¾ã—ãŸã€‚",
    g: "while (they were) attending ã¨ã„ã†çœç•¥ã®å½¢ã§ã™ã€‚",
    p: "exchange studentï¼šäº¤æ›ç•™å­¦ç”Ÿ",
    ans: ""
  },
  {
    e: "Over a period of four years, they made numerous close friends and began to feel completely at home in the culture; their English abilities reached extremely high levels too.",
    t: "4å¹´é–“ã§å¤šãã®å‹äººãŒã§ãã€æ–‡åŒ–ã«å®Œå…¨ã«é¦´æŸ“ã‚“ã§ã„ã‚‹ã¨æ„Ÿã˜ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚å½¼ã‚‰ã®è‹±èªåŠ›ã‚‚æ¥µã‚ã¦é«˜ã„æ°´æº–ã«é”ã—ã¾ã—ãŸã€‚",
    g: "feel at home ã¯ã€Œé¦´æŸ“ã‚€ã€ãã¤ã‚ãã€ã¨ã„ã†ç†Ÿèªã§ã™ã€‚extremely ã¯ã€Œæ¥µã‚ã¦ã€ã§ã™ã€‚",
    p: "numerousï¼šå¤šæ•°ã®\nfeel at homeï¼šé¦´æŸ“ã‚€\nextremelyï¼šæ¥µã‚ã¦",
    ans: ""
  },
  {
    e: "When their visas expired, they had no choice but to move back to Tokyo.",
    t: "ãƒ“ã‚¶ã®æœŸé™ãŒåˆ‡ã‚ŒãŸã¨ãã€å½¼ã‚‰ã¯æ±äº¬ã«æˆ»ã‚‹ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚",
    g: "have no choice but to do ã¯ã€Œã€œã›ã–ã‚‹ã‚’å¾—ãªã„ã€ã¨ã„ã†é‡è¦æ§‹æ–‡ã§ã™ã€‚",
    p: "expireï¼šæœŸé™ãŒåˆ‡ã‚Œã‚‹\nhave no choice but toï¼šã€œã›ã–ã‚‹ã‚’å¾—ãªã„",
    ans: ""
  },
  {
    e: "They got married, worked hard, studied, and ( E ) to the US.",
    t: "å½¼ã‚‰ã¯çµå©šã—ã€æ‡¸å‘½ã«åƒãã€å‹‰å¼·ã—ã€ãã—ã¦ã‚¢ãƒ¡ãƒªã‚«ã«åˆæ³•çš„ã«æˆ»ã‚‹æ©Ÿä¼šã‚’æ¨¡ç´¢ã—ã¾ã—ãŸã€‚",
    g: "sought ã¯ seekï¼ˆæ¢ã™ï¼‰ã®éå»å½¢ã§ã™ã€‚seek out ã§ã€Œæ¢ã—å‡ºã™ã€ã¨ãªã‚Šã¾ã™ã€‚",
    p: "seek outï¼šæ¢ã—å‡ºã™\nlegallyï¼šåˆæ³•çš„ã«",
    ans: "6",
    hint: "ã‚¢ãƒ¡ãƒªã‚«ã¸å†ã³æˆ»ã‚‹ãŸã‚ã®è¡Œå‹•ã‚’æŒ‡ã™è¨€è‘‰ã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚"
  },
  {
    e: "A few years went by and they started a family.",
    t: "æ•°å¹´ãŒçµŒã¡ã€å½¼ã‚‰ã¯å®¶åº­ã‚’ç¯‰ãã¾ã—ãŸã€‚",
    g: "go by ã¯ã€Œï¼ˆæ™‚é–“ãŒï¼‰çµŒéã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚",
    p: "go byï¼šçµŒéã™ã‚‹",
    ans: ""
  },
  {
    e: "Kanako and Masa decided that as far as possible they would speak only English in the home in order to prepare their kids for a future life overseas.",
    t: "å½¼ã‚‰ã¯å­ä¾›ãŸã¡ã®å°†æ¥ã®æµ·å¤–ç”Ÿæ´»ã«å‚™ãˆã‚‹ãŸã‚ã€å®¶åº­å†…ã§ã¯ã§ãã‚‹é™ã‚Šè‹±èªã ã‘ã‚’è©±ã™ã“ã¨ã«æ±ºã‚ã¾ã—ãŸã€‚",
    g: "as far as possible ã¯ã€Œå¯èƒ½ãªé™ã‚Šã€ã€in order to ã¯ã€Œã€œã™ã‚‹ãŸã‚ã«ã€ã§ã™ã€‚",
    p: "as far as possibleï¼šå¯èƒ½ãªé™ã‚Š\nin order toï¼šã€œã™ã‚‹ãŸã‚ã«\noverseasï¼šæµ·å¤–ã®",
    ans: ""
  },
  {
    e: "As you can imagine, this is easier said than done.",
    t: "ã”æƒ³åƒã®é€šã‚Šã€ã“ã‚Œã¯è¨€ã†ã¯æ˜“ãè¡Œã†ã¯é›£ã—ã§ã™ã€‚",
    g: "Easier said than done ã¯ã‚ˆãä½¿ã‚ã‚Œã‚‹æ…£ç”¨è¡¨ç¾ã§ã™ã€‚",
    p: "imagineï¼šæƒ³åƒã™ã‚‹",
    ans: ""
  },
  {
    e: "The young ones still needed to function in Japanese society while the parents waited â€” job offers and visa approvals were taking more time to secure than anticipated.",
    t: "ä¸¡è¦ªãŒå¾…ã¤é–“ã€å¹¼ã„å­ä¾›ãŸã¡ã¯ä¾ç„¶ã¨ã—ã¦æ—¥æœ¬ç¤¾ä¼šã§ç”Ÿæ´»ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ä»•äº‹ã®ã‚ªãƒ•ã‚¡ãƒ¼ã‚„ãƒ“ã‚¶ã®æ‰¿èªã‚’å¾—ã‚‹ã«ã¯ã€äºˆæƒ³ä»¥ä¸Šã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã¾ã—ãŸã€‚",
    g: "more ... than anticipated ã¯ã€Œäºˆæƒ³ã—ã¦ã„ãŸã‚ˆã‚Šã‚‚å¤šãã®â€¦ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚",
    p: "functionï¼šæ´»å‹•ã™ã‚‹ãƒ»ç”Ÿæ´»ã™ã‚‹\napprovalï¼šæ‰¿èª",
    ans: ""
  },
  {
    e: "Eventually, the dream of Masa and Kanako came true.",
    t: "ã¤ã„ã«ã€ãƒã‚µã¨ã‚«ãƒŠã‚³ã®å¤¢ã¯å®Ÿç¾ã—ã¾ã—ãŸã€‚",
    g: "come true ã§ã€Œï¼ˆå¤¢ãªã©ãŒï¼‰å¶ã†ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚",
    p: "eventuallyï¼šã¤ã„ã«",
    ans: ""
  },
  {
    e: "They continue to have high hopes for raising their children as bilinguals in the US; the motive for them involves a mixture of identity and opportunity.",
    t: "å½¼ã‚‰ã¯ã‚¢ãƒ¡ãƒªã‚«ã§å­ä¾›ãŸã¡ã‚’ãƒã‚¤ãƒªãƒ³ã‚¬ãƒ«ã¨ã—ã¦è‚²ã¦ã‚‹ã“ã¨ã«é«˜ã„å¸Œæœ›ã‚’æŒã¡ç¶šã‘ã¦ã„ã¾ã™ã€‚å½¼ã‚‰ã«ã¨ã£ã¦ã®å‹•æ©Ÿã¯ã€ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨æ©Ÿä¼šã®ä¸¡æ–¹ãŒæ··ã–ã‚Šåˆã£ãŸã‚‚ã®ã§ã™ã€‚",
    g: "mixture of A and B ã¯ã€ŒAã¨Bã®æ··ã–ã‚Šåˆã£ãŸã‚‚ã®ã€ã§ã™ã€‚",
    p: "motiveï¼šå‹•æ©Ÿ\ninvolveï¼šä¼´ã†",
    ans: ""
  },
  {
    e: "These short tales express how approaches to bilingualism vary from case to case, suggesting how great a challenge it would be for an entire society to set policies on bilingual education since ( F ) play a role in decision-making among families.",
    t: "ã“ã‚Œã‚‰ã®ç‰©èªã¯äº‹ä¾‹ã«ã‚ˆã‚Šæ§˜ã€…ã§ã‚ã‚Šã€å®¶æ—ã®æ„æ€æ±ºå®šã«ã¯å€‹äººçš„ãªå•é¡ŒãŒå½“ç„¶å½¹å‰²ã‚’æœãŸã™ãŸã‚ã€æ•™è‚²æ”¿ç­–ã‚’å®šã‚ã‚‹å›°é›£ã•ã‚’ç¤ºå”†ã—ã¦ã„ã¾ã™ã€‚",
    g: "vary from case to case ã§ã€Œäº‹ä¾‹ã«ã‚ˆã£ã¦ç•°ãªã‚‹ã€ã€‚play a role in... ã¯ã€Œã€œã«ãŠã„ã¦å½¹å‰²ã‚’æœãŸã™ã€ã§ã™ã€‚",
    p: "varyï¼šç•°ãªã‚‹\nplay a role inï¼šã€œã§å½¹å‰²ã‚’æœãŸã™\ndecision-makingï¼šæ„æ€æ±ºå®š",
    ans: "2",
    hint: "ç¤¾ä¼šå…¨ä½“ã§ã®ä¸€å¾‹ã®æ”¿ç­–æ±ºå®šãŒé›£ã—ã„ç†ç”±ã¨ã—ã¦ã€ä½•ãŒé–¢ã‚ã£ã¦ã„ã‚‹ã‹ã‚’è€ƒãˆã¾ã™ã€‚"
  }
];

// æä¾›ã•ã‚ŒãŸå˜èªãƒ‡ãƒ¼ã‚¿ã‚’æ­£ç¢ºã«ä¸€å­—ä¸€å¥ç¶²ç¾…ï¼ˆå˜èªã€ç™ºéŸ³ã€æ„å‘³ï¼‰
const vocabData = {
  "identity": { r: "ã‚¢ã‚¤ã€ãƒ‡ã€‘ãƒ³ãƒ†ã‚£ãƒ†ã‚£", m: "ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€è‡ªå·±åŒä¸€æ€§" },
  "opportunity": { r: "ã‚¢ãƒ‘ã€ãƒ†ãƒ¥ã€‘ãƒ‹ãƒ†ã‚£", m: "æ©Ÿä¼šã€ãƒãƒ£ãƒ³ã‚¹" },
  "factor": { r: "ã€ãƒ•ã‚¡ã€‘ã‚¯ã‚¿ãƒ¼", m: "è¦å› ã€è¦ç´ " },
  "affect": { r: "ã‚¢ã€ãƒ•ã‚§ã€‘ã‚¯ãƒˆ", m: "ã€œã«å½±éŸ¿ã‚’ä¸ãˆã‚‹" },
  "bilingual": { r: "ãƒã‚¤ã€ãƒªã€‘ãƒ³ã‚®ãƒ¥ã‚¢ãƒ«", m: "2è¨€èªã‚’è©±ã™ï¼ˆäººï¼‰" },
  "graduate from": { r: "ã‚°ã€ãƒ©ã€‘ã‚¸ãƒ¥ã‚¨ã‚¤ãƒˆãƒ»ãƒ•ãƒ­ãƒ ", m: "ã€œã‚’å’æ¥­ã™ã‚‹" },
  "employment": { r: "ã‚¤ãƒ ãƒ—ã€ãƒ­ã‚£ã€‘ãƒ¡ãƒ³ãƒˆ", m: "é›‡ç”¨ã€è·" },
  "eventually": { r: "ã‚¤ã€ãƒ´ã‚§ã€‘ãƒ³ãƒãƒ¥ã‚¢ãƒªãƒ¼", m: "æœ€çµ‚çš„ã«ã€çµå±€ã¯" },
  "permanent": { r: "ã€ãƒ‘ã€‘ãƒ¼ãƒãƒãƒ³ãƒˆ", m: "æ°¸ä¹…çš„ãªã€ä¸å¤‰ã®" },
  "status": { r: "ã‚¹ã€ãƒ†ã€‘ã‚¤ã‚¿ã‚¹", m: "åœ°ä½ã€èº«åˆ†ã€çŠ¶æ³" },
  "conscious": { r: "ã€ã‚«ã€‘ãƒ³ã‚·ãƒ£ã‚¹", m: "æ„è­˜çš„ãªã€è‡ªè¦šã—ã¦ã„ã‚‹" },
  "effort": { r: "ã€ã‚¨ã€‘ãƒ•ã‚©ãƒ¼ãƒˆ", m: "åŠªåŠ›" },
  "official": { r: "ã‚ªã€ãƒ•ã‚£ã€‘ã‚·ãƒ£ãƒ«", m: "å…¬å¼ã®ã€å…¬çš„ãª" },
  "roughly": { r: "ã€ãƒ©ã€‘ãƒ•ãƒªãƒ¼", m: "ãŠã‚ˆãã€ã–ã£ã¨" },
  "struggle": { r: "ã‚¹ãƒˆã€ãƒ©ã€‘ã‚°ãƒ«", m: "è‹¦é—˜ã™ã‚‹ã€ã‚‚ãŒã" },
  "ensure": { r: "ã‚¤ãƒ³ã€ã‚·ãƒ¥ã€‘ã‚¢", m: "ã€œã‚’ç¢ºå®Ÿã«ã™ã‚‹ã€ä¿è¨¼ã™ã‚‹" },
  "hardly": { r: "ã€ãƒã€‘ãƒ¼ãƒ‰ãƒªãƒ¼", m: "ã»ã¨ã‚“ã©ã€œãªã„" },
  "highly": { r: "ã€ãƒã€‘ã‚¤ãƒªãƒ¼", m: "é«˜åº¦ã«ã€éå¸¸ã«" },
  "skilled": { r: "ã‚¹ã€ã‚­ã€‘ãƒ«ãƒ‰", m: "ç†Ÿç·´ã—ãŸã€è…•ã®è‰¯ã„" },
  "regularly": { r: "ã€ãƒ¬ã€‘ã‚®ãƒ¥ãƒ©ãƒªãƒ¼", m: "å®šæœŸçš„ã«" },
  "promotion": { r: "ãƒ—ãƒ­ã€ãƒ¢ã€‘ãƒ¼ã‚·ãƒ§ãƒ³", m: "æ˜‡é€²ã€ä¿ƒé€²" },
  "recognize": { r: "ã€ãƒ¬ã€‘ã‚«ã‚°ãƒŠã‚¤ã‚º", m: "èªè­˜ã™ã‚‹ã€èªã‚ã‚‹" },
  "operate": { r: "ã€ã‚¢ã€‘ãƒ‘ãƒ¬ã‚¤ãƒˆ", m: "é‹å–¶ã™ã‚‹ã€ä½œå‹•ã™ã‚‹" },
  "disappointed": { r: "ãƒ‡ã‚£ã‚µã€ãƒã€‘ã‚¤ãƒ³ãƒ†ã‚£ãƒƒãƒ‰", m: "å¤±æœ›ã—ãŸã€ãŒã£ã‹ã‚Šã—ãŸ" },
  "firmly": { r: "ã€ãƒ•ã‚¡ã€‘ãƒ¼ãƒ ãƒªãƒ¼", m: "å …ãã€æ–­å›ºã¨ã—ã¦" },
  "resolve": { r: "ãƒªã€ã‚¾ã€‘ãƒ«ãƒ´", m: "æ±ºå¿ƒã™ã‚‹ã€è§£æ±ºã™ã‚‹" },
  "lengthy": { r: "ã€ãƒ¬ã€‘ãƒ³ã‚°ã‚¹ã‚£ãƒ¼", m: "éå¸¸ã«é•·ã„" },
  "perceive": { r: "ãƒ‘ã€ã‚¹ã‚£ã€‘ãƒ¼ãƒ´", m: "ã€œã‚’çŸ¥è¦šã™ã‚‹ã€èªè­˜ã™ã‚‹" },
  "succeed": { r: "ã‚µã‚¯ã€ã‚¹ã‚£ã€‘ãƒ¼ãƒ‰", m: "æˆåŠŸã™ã‚‹" },
  "numerous": { r: "ã€ãƒ‹ãƒ¥ã€‘ãƒ¼ãƒãƒ©ã‚¹", m: "å¤šæ•°ã®" },
  "extremely": { r: "ã‚¤ã‚¯ã‚¹ãƒˆã€ãƒªã€‘ãƒ¼ãƒ ãƒªãƒ¼", m: "æ¥µã‚ã¦ã€éå¸¸ã«" },
  "expire": { r: "ã‚¤ã‚¯ã‚¹ã€ãƒ‘ã€‘ã‚¤ã‚¢", m: "ï¼ˆæœŸé™ãŒï¼‰åˆ‡ã‚Œã‚‹" },
  "legally": { r: "ã€ãƒªã€‘ãƒ¼ã‚¬ãƒªãƒ¼", m: "åˆæ³•çš„ã«" },
  "function": { r: "ã€ãƒ•ã‚¡ã€‘ãƒ³ã‚¯ã‚·ãƒ§ãƒ³", m: "æ©Ÿèƒ½ã™ã‚‹ã€æ´»å‹•ã™ã‚‹" },
  "approval": { r: "ã‚¢ãƒ—ã€ãƒ«ã€‘ãƒ¼ãƒ´ã‚¡ãƒ«", m: "æ‰¿èªã€è³›æˆ" },
  "anticipate": { r: "ã‚¢ãƒ³ã€ãƒ†ã‚£ã€‘ã‚¹ã‚£ãƒšã‚¤ãƒˆ", m: "ã€œã‚’äºˆæƒ³ã™ã‚‹ã€æœŸå¾…ã™ã‚‹" },
  "motive": { r: "ã€ãƒ¢ã€‘ã‚¦ãƒ†ã‚£ãƒ´", m: "å‹•æ©Ÿã€ç›®çš„" },
  "mixture": { r: "ã€ãƒŸã€‘ã‚¯ã‚¹ãƒãƒ£", m: "æ··åˆï¼ˆç‰©ï¼‰" },
  "policy": { r: "ã€ãƒã€‘ãƒªã‚¹ã‚£ãƒ¼", m: "æ”¿ç­–ã€æ–¹é‡" },
  "vary": { r: "ã€ãƒ´ã‚§ã€‘ã‚¢ãƒª", m: "ç•°ãªã‚‹ã€æ§˜ã€…ã§ã‚ã‚‹" },
  "success": { r: "ã‚µã‚¯ã€ã‚»ã€‘ã‚¹", m: "æˆåŠŸ" }
};

const choiceTexts = { "1": "struggled to communicate so much that", "2": "personal issues naturally", "4": "did not feel too disappointed", "6": "sought out opportunities to legally return", "7": "short stories that explain how", "9": "made a conscious effort to speak with their children" };

let myVocab = JSON.parse(localStorage.getItem('fukuokaVocab') || '[]');
let currentVIdx = 0; let vTestQueue = [];

function init() {
  const container = document.getElementById('main-content');
  syntaxData.forEach((d, i) => {
    let eHtml = d.e;
    Object.keys(vocabData).forEach(v => {
      const reg = new RegExp(`\\b${v}\\b`, 'gi');
      eHtml = eHtml.replace(reg, `<span class="dict-word" onclick="pop(event,'${v}')">$&</span>`);
    });
    eHtml = eHtml.replace(/\( ([A-F]) \)/g, `<span style="font-weight:bold; color:var(--fu-red);">($1)</span>`);

    const div = document.createElement('div');
    div.className = 'sentence-block';
    div.onclick = function(e) { if(e.target.className !== 'dict-word') this.classList.toggle('highlight'); };
    div.innerHTML = `
      <span class="eng-text"><strong>${i+1}.</strong> ${eHtml}</span>
      <div style="margin-top:8px;">
        <button class="btn" onclick="speak('${d.e.replace(/\( [A-F] \)/g, '')}')">ğŸ”Š å†ç”Ÿ</button>
        <button class="btn btn-sub" onclick="toggleT(${i})">å’Œè¨³</button>
        <button class="btn btn-sub" onclick="openM(${i})">å®Œå…¨è§£èª¬</button>
      </div>
      <div id="trans-${i}" style="display:none; color:var(--fu-red); font-weight:bold; margin-top:10px; background:#fffafa; padding:10px; border-radius:5px;">${d.t}</div>
    `;
    container.appendChild(div);
  });
  renderVocab();
}

function pop(e, w) {
  e.stopPropagation();
  const p = document.getElementById('word-popup');
  const info = vocabData[w.toLowerCase()] || vocabData[w.toLowerCase().replace(/ed$|ing$|s$/, "")];
  if(!info) return;
  p.innerHTML = `
    <strong>${w}</strong><br><small>${info.r}</small><br><b>${info.m}</b><br>
    <div style="margin-top:10px;">
      <button class="btn" style="padding:4px 8px; font-size:0.8em;" onclick="speak('${w}')">ğŸ”Š å†ç”Ÿ</button>
      <button class="btn" style="padding:4px 8px; font-size:0.8em; margin-left:5px;" onclick="saveVocab('${w}')">ä¿å­˜</button>
    </div>
  `;
  p.style.display = 'block'; p.style.left = e.pageX + 'px'; p.style.top = e.pageY + 'px';
  setTimeout(() => p.style.display = 'none', 5000);
}

function saveVocab(w) { if(!myVocab.includes(w)) { myVocab.push(w); localStorage.setItem('fukuokaVocab', JSON.stringify(myVocab)); renderVocab(); alert("ä¿å­˜ã—ã¾ã—ãŸï¼"); } }
function renderVocab() { const l = document.getElementById('my-vocab-list'); const a = document.getElementById('vocab-test-entry'); if(myVocab.length > 0) { l.innerHTML = myVocab.map(w => `<div style="border:1px solid var(--fu-red); display:inline-block; margin:5px; padding:8px; border-radius:5px;"><b>${w}</b></div>`).join(''); a.style.display = 'block'; } else { l.innerHTML = "<p>ä¿å­˜ã•ã‚ŒãŸå˜èªã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>"; a.style.display = 'none'; } }
function clearVocab() { if(confirm("å˜èªå¸³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) { myVocab = []; localStorage.removeItem('fukuokaVocab'); renderVocab(); } }

function startVocabTest() {
  if(myVocab.length < 2) return alert("2èªä»¥ä¸Šä¿å­˜ã—ã¦ãã ã•ã„ã€‚");
  document.getElementById('learning-ui').style.display = 'none';
  document.getElementById('vocab-test-section').style.display = 'block';
  vTestQueue = [...myVocab].sort(() => Math.random() - 0.5);
  currentVIdx = 0; showNextV();
}
function showNextV() {
  if(currentVIdx >= vTestQueue.length) { alert("å…¨å•çµ‚äº†ï¼"); return showLearning(); }
  const word = vTestQueue[currentVIdx];
  const info = vocabData[word.toLowerCase()] || vocabData[word.toLowerCase().replace(/ed$|ing$|s$/, "")];
  document.getElementById('v-test-q-num').innerText = `${currentVIdx+1}/${vTestQueue.length}`;
  document.getElementById('v-test-word').innerText = word;
  let cs = [info.m];
  let os = Object.values(vocabData).map(v => v.m).filter(m => m !== info.m);
  cs.push(...os.sort(() => Math.random() - 0.5).slice(0, 3));
  cs.sort(() => Math.random() - 0.5);
  document.getElementById('v-test-choices').innerHTML = cs.map(c => `<button class="v-choice-btn" onclick="checkV('${c}','${info.m}')">${c}</button>`).join('');
  document.getElementById('v-test-feedback').innerText = "";
}
function checkV(s, c) { const f = document.getElementById('v-test-feedback'); if(s === c) { f.innerText="æ­£è§£ï¼"; f.style.color="green"; setTimeout(() => { currentVIdx++; showNextV(); }, 800); } else { f.innerText=`ä¸æ­£è§£ï¼æ­£è§£ã¯ã€Œ${c}ã€`; f.style.color="red"; setTimeout(() => { currentVIdx++; showNextV(); }, 1500); } }

function showTest() {
  document.getElementById('learning-ui').style.display = 'none';
  document.getElementById('test-section').style.display = 'block';
  const container = document.getElementById('test-content');
  const blanks = syntaxData.filter(d => d.ans !== "");
  container.innerHTML = blanks.map((d, i) => {
    let q = d.e.replace(/\( ([A-F]) \)/, `<select id="q-${i}"><option value="">--é¸æŠ--</option>${Object.keys(choiceTexts).map(k => `<option value="${k}">${k}. ${choiceTexts[k]}</option>`).join('')}</select>`);
    return `<div style="margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:10px;"><strong>å• ${["A","B","C","D","E","F"][i]}:</strong><br>${q}</div>`;
  }).join('');
}
function judge() {
  const blanks = syntaxData.filter(d => d.ans !== "");
  let score = 0; let ms = [];
  blanks.forEach((d, i) => { if(document.getElementById(`q-${i}`).value === d.ans) score++; else ms.push({l: ["A","B","C","D","E","F"][i], h: d.hint}); });
  const area = document.getElementById('result-area');
  if(score === blanks.length) area.innerHTML = `<div class="card" style="border-color:#27ae60; background:#e8f8f5; text-align:center;"><h2>ğŸ‰ å®Œç’§ã§ã™ï¼æº€ç‚¹åˆæ ¼ï¼ ğŸ‰</h2></div>`;
  else area.innerHTML = `<div class="card" style="border-color:var(--fu-red);"><h2>çµæœï¼š${score}/${blanks.length}</h2>${ms.map(m => `<div class="info-box">å• ${m.l} ã®ãƒ’ãƒ³ãƒˆï¼š${m.h}</div>`).join('')}</div>`;
  area.innerHTML += blanks.map((d, i) => `<button class="btn btn-sub" style="margin:5px;" onclick="openM_raw('${d.e}','${d.g}','${d.p}')">å• ${["A","B","C","D","E","F"][i]} è§£èª¬</button>`).join('');
}
function openM_raw(e, g, p) { document.getElementById('m-title').innerText = "è§£èª¬"; document.getElementById('m-body').innerHTML = `<div class="info-box"><strong>è‹±æ–‡</strong><br>${e}</div><div class="info-box"><strong>æ–‡æ³•</strong><br>${g}</div><div class="info-box"><strong>è¡¨ç¾</strong><br>${p}</div>`; document.getElementById('modal').style.display = 'flex'; }

function showLearning() { document.getElementById('learning-ui').style.display = 'block'; document.getElementById('test-section').style.display = 'none'; document.getElementById('vocab-test-section').style.display = 'none'; }
function toggleT(i) { const el = document.getElementById(`trans-${i}`); el.style.display = el.style.display === 'none' ? 'block' : 'none'; }
function openM(i) { const d = syntaxData[i]; document.getElementById('m-title').innerText = `No.${i+1} å®Œå…¨è§£èª¬`; document.getElementById('m-body').innerHTML = `<div class="info-box"><strong>æ–‡æ³•äº‹é …</strong><br>${d.g}</div><div class="info-box"><strong>é‡è¦è¡¨ç¾</strong><br>${d.p}</div>`; document.getElementById('modal').style.display = 'flex'; }
function closeM() { document.getElementById('modal').style.display = 'none'; }

init();
</script>
</body>
</html>
